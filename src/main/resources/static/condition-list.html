<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¡°ê±´ ëª©ë¡</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .condition-card { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 6px; }
    button { margin-top: 0.5rem; }
  </style>
</head>
<body>
<div class="top">
  <h1>ğŸ“‹ ë“±ë¡ëœ ì¡°ê±´ ëª©ë¡</h1>
  <button onclick="location.href='/me.html'">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>

<div id="conditions">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<script>
  const params = new URLSearchParams(location.search);
  const projectKey = params.get('projectKey');
  const container = document.getElementById('conditions');

  if (!projectKey) {
    alert('projectKeyê°€ ì—†ìŠµë‹ˆë‹¤.');
    location.href = '/me.html';
  }

  fetch(`/api/conditions/${projectKey}`)
    .then(res => res.json())
    .then(conditions => {
      container.innerHTML = '';
      if (!Array.isArray(conditions) || conditions.length === 0) {
        container.textContent = 'ì¡°ê±´ì´ ì—†ìŠµë‹ˆë‹¤.';
        return;
      }

      conditions.forEach(c => {
        const div = document.createElement('div');
        div.className = 'condition-card';

        const minEmails = (c.segmentMinEmails !== null && c.segmentMinEmails !== undefined)
          ? c.segmentMinEmails
          : 5;

        div.innerHTML = `
          <div><strong>ì´ë²¤íŠ¸:</strong> ${c.eventType}</div>
          <div><strong>í˜ì´ì§€ URL:</strong> ${c.pageUrl}</div>
          <div><strong>ì—°ì‚°ì:</strong> ${c.operator}</div>
          <div><strong>ì„ê³„ê°’:</strong> ${c.threshold}</div>
          <div><strong>ì„¸ê·¸ë¨¼íŠ¸ ìµœì†Œ ì´ë©”ì¼ ìˆ˜:</strong> ${minEmails}</div>
          <button onclick="deleteCondition('${c.id}')">ğŸ—‘ ì‚­ì œ</button>
        `;
        container.appendChild(div);
      });
    })
    .catch(() => {
      container.textContent = 'ì¡°ê±´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    });

  function deleteCondition(id) {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    fetch(`/api/conditions/${id}`, { method: 'DELETE' })
      .then(res => {
        if (res.ok) {
          alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨');
        }
      })
      .catch(() => alert('ì‚­ì œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
  }
</script>

</body>
</html>
