<!-- src/main/resources/static/test.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SDK 테스트 페이지</title>

    <!-- 1) SDK 스니펫 삽입 -->
    <script src="https://behavior-tracking-sdk.vercel.app/sdk.js"
            data-key-prod="478a7347-9049-441e-9aff-bb0a3c01c882"
            data-key-dev ="c7fbd9f0-38a9-4802-8859-c669bd5ca7d6">
    </script>

    <!-- 2) SDK 초기화 -->
    <script>
        window.addEventListener('DOMContentLoaded', function() {
          const host = window.location.hostname;

          // 1) apiUrl 분기
          const apiUrl = host.includes('-dev.')
            ? 'https://sdk-behavior-trigger-mvp-dev.onrender.com'
            : 'https://sdk-behavior-trigger-mvp.onrender.com';

          // 2) projectKey 분기 (data-key-* 어트리뷰트에서 읽기)
          const sdkScript = document.querySelector('script[src*="sdk.js"]');
          const projectKey = host.includes('-dev.')
            ? sdkScript.dataset.keyDev
            : sdkScript.dataset.keyProd;

          BehaviorSDK.init({
            apiUrl,
            projectKey,
            scrollThreshold: 0.3
          });
        });
    </script>
</head>
<body>
<h1>SDK 동작 확인용 테스트 페이지</h1>
<!-- ... 나머지 UI ... -->

<!-- 3) 로그 조회 분기 -->
<script>
    document.getElementById('btnFetchLogs')
      .addEventListener('click', async () => {
        const host = window.location.hostname;
        const apiUrl = host.includes('-dev.')
          ? 'https://sdk-behavior-trigger-mvp-dev.onrender.com'
          : 'https://sdk-behavior-trigger-mvp.onrender.com';

        // 위 init 코드와 똑같은 로직으로 projectKey 뽑아 써도 되고,
        // 단순 조회이므로 URL에만 필요하다면 세팅 안 해도 됩니다.
        const visitorId = localStorage.getItem('visitorId')
                         || document.cookie.match(/visitorId=([^;]+)/)?.[1];
        if (!visitorId) {
          return alert('visitorId가 없습니다. 새로고침 후 다시 시도하세요.');
        }

        const res = await fetch(
          `${apiUrl}/api/logs?projectId=${host.includes('-dev.')
            ? sdkScript.dataset.keyDev
            : sdkScript.dataset.keyProd
          }&visitorId=${visitorId}`
        );
        const text = await res.text();
        document.getElementById('logOutput').textContent =
          res.ok ? JSON.stringify(JSON.parse(text), null, 2)
                : `Error ${res.status}:\n${text}`;
      });
</script>
</body>
</html>
