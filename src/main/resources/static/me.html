<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚´ ì •ë³´ / SDK ì‚½ì… ì•ˆë‚´</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #fff;
    }
    h1, h2 {
      color: #333;
    }
    #info {
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 5px;
      margin-top: 1rem;
    }
    .label {
      font-weight: bold;
      margin-top: 0.75rem;
    }
    pre {
      background: #eee;
      padding: 0.5rem;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    button.copy-btn {
      margin-top: 0.5rem;
      padding: 5px 10px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .note {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #666;
      background: #f0f0f0;
      padding: 0.5rem;
      border-left: 4px solid #999;
    }
  </style>
</head>
<body>

<h1>ë‚´ í”„ë¡œì íŠ¸ ì •ë³´</h1>
<div id="info">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<script>
  const token = localStorage.getItem('token');
  const infoDiv = document.getElementById('info');

  if (!token) {
    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    location.href = '/login.html';
  } else {
    fetch('/api/users/me', {
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
    .then(async res => {
      if (!res.ok) {
        const text = await res.text();
        throw new Error(`ì˜¤ë¥˜ ${res.status}: ${text}`);
      }
      return res.json();
    })
    .then(data => {
      const key = data.project_key || '(ì—†ìŒ)';
      const scriptSnippet = `
<script src="https://behavior-tracking-sdk.vercel.app/sdk.js"
      data-key="${key}">
</script>`.trim();

infoDiv.innerHTML = `
<div class="label">ğŸ“§ ì´ë©”ì¼:</div>
<div>${data.email || '(ì—†ìŒ)'}</div>

<div class="label">ğŸ§¾ í”„ë¡œì íŠ¸ëª…:</div>
<div>${data.project_name || '(ì—†ìŒ)'}</div>

<div class="label">ğŸŒ ë„ë©”ì¸:</div>
<div>${data.domain || '(ì—†ìŒ)'}</div>

<div class="label">ğŸ”‘ SDK ìŠ¤ë‹ˆí«:</div>
<pre id="snippet">${scriptSnippet}</pre>
<button class="copy-btn" onclick="copySnippet()">ìŠ¤ë‹ˆí« ë³µì‚¬í•˜ê¸°</button>

<div class="note">
  ìœ„ ì½”ë“œë¥¼ ë³¸ì¸ì˜ ì›¹ì‚¬ì´íŠ¸ HTMLì˜ &lt;head&gt; ë˜ëŠ” &lt;body&gt; íƒœê·¸ í•˜ë‹¨ì— ì‚½ì…í•˜ì„¸ìš”.<br>
  ì´ SDKëŠ” ë°©ë¬¸ìì˜ ë¡œê·¸ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³ , ì¡°ê±´ì— ë”°ë¼ ì´ë©”ì¼ ë°œì†¡ ë“± íŠ¸ë¦¬ê±°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
</div>
`;
})
.catch(err => {
console.error(err);
infoDiv.textContent = 'ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + err.message;
});
}

function copySnippet() {
const text = document.getElementById('snippet')?.innerText;
if (!text || text.includes('(ì—†ìŒ)')) return alert('ìŠ¤ë‹ˆí«ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');

navigator.clipboard.writeText(text)
.then(() => alert('ìŠ¤ë‹ˆí«ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
.catch(() => alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
}
</script>

</body>
</html>
